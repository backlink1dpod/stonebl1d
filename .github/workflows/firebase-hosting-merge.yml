name: Deploy to Firebase Hosting on merge
on:
  push:
    branches:
      - main # Hoặc master tùy tên nhánh chính của bạn

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Lấy code về
      - uses: actions/checkout@v4
        with:
          submodules: recursive # Quan trọng: Hugoplate thường dùng submodule cho theme

      # 2. Cài đặt Node.js v22 (Theo yêu cầu của Hugoplate)
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      # 3. Cài đặt Go v1.24 (Theo yêu cầu của Hugoplate)
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24'

      # 4. Cài đặt Hugo Extended v0.144+ (Bắt buộc bản Extended để xử lý CSS/Tailwind)
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: '0.144.0' # Hoặc 'latest'
          extended: true

      # 5. Cài đặt dependencies (TailwindCSS, v.v.)
      - name: Install Dependencies
        run: npm install

      # 6. Lệnh BUILD thực sự (Tạo ra thư mục public)
      - name: Build Site
        run: hugo --minify

      # 7. Đẩy lên Firebase
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_YOUR_ID }}'
          channelId: live
          projectId: your-project-id # Thay bằng ID dự án Firebase của bạn